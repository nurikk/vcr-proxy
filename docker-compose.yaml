services:
  vcr-proxy:
    build: .
    ports:
      - "8080:8080"
      - "8081:8081"
    environment:
      VCR_MODE: spy
    volumes:
      - ./cassettes:/app/cassettes
      - ./vcr-proxy.yaml:/app/vcr-proxy.yaml:ro

  vcr-forward-proxy:
    build: .
    ports:
      - "8888:8888"
      - "8082:8081"
    environment:
      VCR_MODE: spy
      VCR_FORWARD_PROXY_PORT: "8888"
    volumes:
      - ./cassettes:/app/cassettes
    command: ["uv", "run", "vcr-forward-proxy"]

  tests-ci:
    build:
      context: .
      dockerfile: Dockerfile
      target: test
      args:
        PYTHON_VERSION: ${PYTHON_VERSION:-3.13}
    command: ["uv", "run", "pytest", "-v", "--tb=short"]
